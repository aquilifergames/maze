<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Safe Zone</title>
        <script src="phaser.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        var game = new Phaser.Game(800, 780, Phaser.CANVAS, '', { preload: preload, create: create, update: update, render: render});
        var map;
        var mainCharacter;
        var colissionLayer;
        var safeZones;
        var background;
        var exit;

        function preload () {
            game.time.advancedTiming = true;
            game.physics.startSystem(Phaser.Physics.ARCADE);
            //Magic
            //game.world.setBounds(0,0,2000,2000);
            game.load.tilemap('map', 'assets/map3.json', null, Phaser.Tilemap.TILED_JSON);
            game.load.image('mainCharacter', 'assets/ball.png');
            game.load.image('szone', 'assets/greenFire.png');
            game.load.image('exit', 'assets/exit.png');
            game.load.image('tiles', 'assets/tilesheet_complete.png');
        }

        function create () {
            map = game.add.tilemap('map');
            map.addTilesetImage('tilesheet_complete', 'tiles');

            background = map.createLayer('fondo');
            colissionLayer = map.createLayer('colision');
            map.setCollision([0,93], true, colissionLayer);
            game.physics.arcade.enable(colissionLayer);

            safeZones = game.add.group();
            safeZones.enableBody = true;
            map.createFromObjects('zona-carga', 401, 'szone', 0, true, false, safeZones);

            exit = game.add.group();
            exit.enableBody=true;
            map.createFromObjects('exit', 20, 'exit', 0, true, false, exit);

            mainCharacter =  game.add.sprite(95, 95, 'mainCharacter');
            game.physics.arcade.enable(mainCharacter);

            //mainCharacter.body.collideWorldBounds = true;
            mainCharacter.body.setSize(30,30);
            mainCharacter.anchor.set(0.5);   
            //descomentar para que la camara te siga junto con la linea "Magic"
            //game.camera.follow(mainCharacter);
        }

        function update () {
            game.physics.arcade.collide(mainCharacter, colissionLayer);
            game.physics.arcade.overlap(mainCharacter, safeZones, charge, null, this);
            game.physics.arcade.overlap(mainCharacter, exit, finishLevel, null, this);
            cursors = game.input.keyboard.createCursorKeys();

            mainCharacter.body.velocity.x = 0;
            mainCharacter.body.velocity.y = 0;

            if (cursors.left.isDown) {
                mainCharacter.body.velocity.x = -150;
            }

            else if (cursors.right.isDown) {
                mainCharacter.body.velocity.x = 150;
            }

            else if (cursors.up.isDown) {
                mainCharacter.body.velocity.y = -150;
            }

            else if (cursors.down.isDown) {
                 mainCharacter.body.velocity.y = 150;   
            }
        }

        function render () {
           
        
        }
        function charge(){console.log("charging");}

        function discharge(){console.log("discharging");}

        function finishLevel(){console.log("finishLevel");}
    };

    </script>

    </body>
</html>